#!/bin/sh
#
# This script will run `phpstan` tests via `entr` whenever
# a file in roady's core/, Tests/, Apps/*/DynamicOutput,
# or Apps/*/resources directory is modified, or when
# roady's index.php file is modified.
#
# Usage:
#
# runPhpStanTestsOnSave
#

msg() {
    printf '%b%s%b' "\n\n\e[0m\e[105m\e[30m" "$1" "\e[0m\n\n"
}

msgAndExit() {
    msg "$1"
    exit 1
}

pathToPhpProjects="$HOME/dev/php"
pathToRoady="$pathToPhpProjects/roady"
pathToPhpStan="$pathToRoady/vendor/bin/phpstan"

cd "$pathToRoady" || msgAndExit 'roady is not installed'

find \
    "$pathToRoady/tests" \
    "$pathToRoady/src" \
    "$pathToRoady/devTools" \
    -type f -name "*.php" |
    entr -c "$pathToPhpStan"

